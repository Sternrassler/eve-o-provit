#!/usr/bin/env bash
# pre-commit – Lokale Pre-Commit Validierung
# Aktivierung: git config core.hooksPath .githooks
# Referenz: copilot-instructions.md Abschnitt 4

set -euo pipefail

echo "[pre-commit] Führe lokale Validierungen aus..."

# 1. Normative Check
if [ -x scripts/common/check-normative.sh ]; then
    bash scripts/common/check-normative.sh || exit 1
fi

# 2. ADR Consistency Check
if [ -x scripts/common/check-adr.sh ]; then
    bash scripts/common/check-adr.sh || exit 1
fi

# 3. Commit Message Check (wird von Git Hook commit-msg erledigt – hier nur Info)
echo "[pre-commit] Hinweis: Commit Message wird nach diesem Hook geprüft (commit-msg Hook)"

# 4. Secret Scanning mit Gitleaks (via Make Target)
echo "[pre-commit] Prüfe Staging Area auf Secrets (Gitleaks)..."
if ! make secrets-check >/dev/null 2>&1; then
    echo "[pre-commit] ❌ FEHLER: Secret Scanning fehlgeschlagen!"
    echo "Details anzeigen: make secrets-check"
    echo "Verwende 'git commit --no-verify' nur wenn absolut sicher (nicht empfohlen)"
    exit 1
fi

echo "[pre-commit] ✅ Pre-Commit Checks erfolgreich"
exit 0
